{% extends 'base.html' %}

{% block header %}
<h1>Recipe display</h1>
{% if recipe %}
<h2>Title: {{ recipe.title }}</h2>
{%endif%}
{% endblock %}

{% block content %}

{% for message in get_flashed_messages() %}
    <p>{{ message }}</p>
{% endfor %}

<form action="" method="post" id="recipe_view">
      <label for="recipe_mealplan">Select the meal plan that the recipe is associated with </label>
      <!-- recipe_meal connects with add drop list js -->
      <select id= "recipe_mealplan" name= "recipe_mealplan">
            <option value="" selected="selected">None</option>
            {% for x in mealplans_names %}
            <option value="{{x.meal_plan}}">{{x.meal_plan}}</option>
            {% endfor %}
      </select>

      <br>
      <label for="name_recipe_droplist">Select recipe: </label>

      <select id= "name_recipe_droplist" name= "name_recipe_droplist">
      </select>

      <button type ="submit" id="submit_cook">send</button>
</form>


{% if recipe %}
<form action="{{ url_for( 'remove_dish',  planner_name = meal_plan, dish = recipe.title) }}" method="POST" style="float: right;" onsubmit="return confirm('Do you really want to submit the form?');" name="delete_recipe">
      <button type ="submit" >Delete cook's info</button>
</form>

<p>Serves: {{ recipe.servings }}</p>

<p class="ingredients">Ingredients:</p>
<ul class="ingredients">
{% for ingredient in recipe.ingredients %}
<li>{{ ingredient[1] }} {{ ingredient[2] }} of {{ ingredient[0] }}</li>
{% endfor %}
</ul>

<p class="directions">Directions:</p>
<p>{{ recipe.recipe }}</p>

<p class="recipeinfo">Allergens:


{% for allergen in recipe.allergens %}
<li>{{ allergen }}</li>
{% endfor %}
</p>

<p class="recipeinfo">Dietary restrictions:

{% for x in recipe.restrictions%}
<li>{{ x }}</li>
{% endfor %}
</p>
{% endif %}



<script>

  function add_drop_list(array){
    var element = document.getElementById('name_recipe_droplist');

    while (element.hasChildNodes()) {
       element.removeChild(element.lastChild);
    }

    if (array.length > 0){

      for (i = 0; i < array.length; i++) {
        var option = document.createElement('option');
        option.value = array[i];
        option.innerHTML = array[i];
        element.appendChild(option);
      }

    }
    element.appendChild(option);
 };


 $('#recipe_mealplan').change(function() {
   var meal_plan = $("#recipe_mealplan").val();
   if(meal_plan != "")
   {
     $.getJSON( "/_view_recipes",
                {
                meal_plan:meal_plan},
                function(data) {
                  rsval = data.result.response;
                  if (rsval.length == 0){
                    rsval = ["No records found"]
                  }
                  console.log(rsval);
                  add_drop_list(rsval)
                }
             );
   }

 });

 </script>

{% endblock %}
